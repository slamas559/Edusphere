{% extends "dashboard/base.html" %}
{% load widget_tweaks %}
{% load static %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mb-4">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
            </svg>
        </div>
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Upload PDF Document</h2>
        <p class="text-gray-600 dark:text-gray-400">Share educational materials with the community</p>
    </div>

    <!-- Form Container -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 sm:p-8">
        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            {% for field in form %}
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                    {{ field.label }}
                    {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
                </label>
                
                {% if field.name == "file" %}
                <!-- File Upload Field -->
                <div class="flex items-center justify-center w-full">
                    <label for="file-upload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-gray-400 dark:hover:border-gray-500 transition-colors duration-200 bg-gray-50 dark:bg-gray-700/50">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <svg class="w-10 h-10 mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="text-sm text-gray-500 dark:text-gray-400 text-center">
                                <span class="font-semibold">Click to upload</span> or drag and drop
                            </p>
                            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">PDF files only (Max 50MB)</p>
                        </div>
                        {{ field|add_class:"hidden"|attr:"id:file-upload"|attr:"accept:.pdf" }}
                    </label>
                </div>
                <div id="file-preview" class="hidden mt-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-green-600 dark:text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 极速0 9 9 0 0118 0z"></path>
                        </svg>
                        <span id="file-name" class="text-sm text-green-800 dark:text-green-300"></span>
                    </div>
                </div>
                
                {% elif field.name == "title" %}
                <!-- Title Field -->
                {{ field|add_class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-colors duration-200"|attr:"placeholder:Enter a descriptive title (optional)" }}
                
                {% elif field.name == "author" %}
                <!-- Author Field -->
                {{ field|add_class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-colors duration-200"|attr:"placeholder:Document author name" }}
                
                {% elif field.name == "description" %}
                <!-- Description Field -->
                {{ field|add_class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-colors duration-200 resize-vertical min-h-20"|attr:"placeholder:Brief description of the document content"|attr:"rows:3" }}
                
                {% else %}
                <!-- Default Field -->
                {{ field|add_class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-colors duration-200" }}
                {% endif %}
                
                {% if field.help_text %}
                <p class="text-xs text-gray-500 dark:text-gray-400">{{ field.help_text }}</p>
                {% endif %}
                
                {% if field.errors %}
                <div class="flex items-center mt-1">
                    <svg class="w-4 h-4 text-red-500 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p class="text-sm text-red-600 dark:text-red-400">{{ field.errors.0 }}</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200 dark:border-gray-700">
                <button type="submit"
                        class="flex-1 inline-flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-medium rounded-lg transition-all duration-200 shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    Upload PDF
                </button>
                <a href="{% url 'archive' %}"
                   class="flex-1 inline-flex items-center justify-center gap-2 px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<!-- File Upload Script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fileInput = document.getElementById('file-upload');
        const filePreview = document.getElementById('file-preview');
        const fileName = document.getElementById('file-name');
        const uploadLabel = fileInput.parentElement;

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.type === 'application/pdf') {
                    fileName.textContent = file.name;
                    filePreview.classList.remove('hidden');
                    uploadLabel.classList.remove('border-gray-300', 'dark:border-gray-600');
                    uploadLabel.classList.add('border-green-300', 'dark:border-green-600', 'bg-green-50', 'dark:bg-green-900/20');
                } else {
                    alert('Please select a PDF file.');
                    fileInput.value = '';
                }
            }
        });

        // Handle drag and drop
        uploadLabel.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadLabel.classList.add('border-blue-400', 'bg-blue-50', 'dark:bg-blue-900/20');
        });

        uploadLabel.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadLabel.classList.remove('border-blue-400', 'bg-blue-50', 'dark:bg-blue-900/20');
        });

        uploadLabel.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadLabel.classList.remove('border-blue-400', 'bg-blue-50', 'dark:bg-blue-900/20');
            
            if (e.dataTransfer.files.length) {
                const file = e.dataTransfer.files[0];
                if (file.type === 'application/pdf') {
                    fileInput.files = e.dataTransfer.files;
                    const event = new Event('change');
                    fileInput.dispatchEvent(event);
                } else {
                    alert('Please drop a PDF file.');
                }
            }
        });
    });
</script>

<style>
    .resize-vertical {
        resize: vertical;
    }
    input:focus, textarea:focus, select:focus {
        outline: none;
        ring: 2px;
    }
</style>
{% endblock %}